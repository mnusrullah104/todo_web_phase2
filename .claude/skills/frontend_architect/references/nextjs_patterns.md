# Next.js 14+ with App Router Best Practices

## App Directory Structure

```
app/
├── layout.tsx          # Root layout
├── page.tsx           # Home page
├── providers.tsx      # Global providers
├── globals.css        # Global styles
├── api/               # API routes
│   └── ...
├── components/        # Shared components
│   └── ...
├── lib/              # Utilities and constants
│   └── ...
└── [dynamic]/        # Dynamic routes
    └── ...
```

## Page and Layout Conventions

### Root Layout (app/layout.tsx)
```tsx
import './globals.css';
import type { Metadata } from 'next';
import { Inter } from 'next/font/google';

const inter = Inter({ subsets: ['latin'] });

export const metadata: Metadata = {
  title: 'Create Next App',
  description: 'Generated by create next app',
};

export default function RootLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  return (
    <html lang="en">
      <body className={inter.className}>{children}</body>
    </html>
  );
}
```

### Route Handlers (app/api/route.ts)
```tsx
import { NextRequest, NextResponse } from 'next/server';

export async function GET(request: NextRequest) {
  // Handle GET request
  return NextResponse.json({ message: 'Hello' });
}

export async function POST(request: NextRequest) {
  // Handle POST request
  const body = await request.json();
  return NextResponse.json({ received: body });
}
```

## Data Fetching Patterns

### Static Generation
```tsx
// app/page.tsx
export async function generateStaticParams() {
  // Pre-generate static pages
}

export default async function Page() {
  // Server-side rendered content
  return <div>Content</div>;
}
```

### Dynamic Data Fetching
```tsx
// app/user/[id]/page.tsx
import { notFound } from 'next/navigation';

async function getUser(id: string) {
  const res = await fetch(`https://api.example.com/users/${id}`);
  if (!res.ok) return notFound();
  return res.json();
}

export default async function UserPage({ params }: { params: { id: string } }) {
  const user = await getUser(params.id);

  return <div>{user.name}</div>;
}
```

## Component Patterns

### Client Components
```tsx
'use client';

import { useState, useEffect } from 'react';

export default function InteractiveComponent() {
  const [data, setData] = useState(null);

  useEffect(() => {
    // Client-side effects
  }, []);

  return <div>Interactive content</div>;
}
```

### Server Components (Default)
```tsx
import { getData } from '@/lib/data';

export default async function ServerComponent() {
  const data = await getData();

  return <div>{data}</div>;
}
```

## TypeScript Integration

### Props Interface
```tsx
interface UserCardProps {
  user: {
    id: string;
    name: string;
    email: string;
  };
  isActive?: boolean;
}

export default function UserCard({ user, isActive = false }: UserCardProps) {
  return (
    <div className={`card ${isActive ? 'active' : ''}`}>
      <h3>{user.name}</h3>
      <p>{user.email}</p>
    </div>
  );
}
```

### Route Parameters
```tsx
interface UserPageProps {
  params: Promise<{ id: string }>;
  searchParams: Promise<{ [key: string]: string | string[] | undefined }>;
}

export default async function UserPage({ params }: UserPageProps) {
  const { id } = await params;
  return <div>User ID: {id}</div>;
}
```

## Error Boundaries and Loading States

### Global Error Boundary
```tsx
'use client';

import { useEffect } from 'react';

export default function GlobalError({
  error,
  reset,
}: {
  error: Error & { digest?: string };
  reset: () => void;
}) {
  useEffect(() => {
    console.error(error);
  }, [error]);

  return (
    <html>
      <body>
        <h2>Something went wrong!</h2>
        <button onClick={() => reset()}>Try again</button>
      </body>
    </html>
  );
}
```

### Loading Component
```tsx
// app/loading.tsx
export default function Loading() {
  return (
    <div className="flex items-center justify-center h-screen">
      <div>Loading...</div>
    </div>
  );
}
```